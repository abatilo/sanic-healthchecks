version: 2
jobs:
  lint:
    docker:
      - image: python:3.7
    working_directory: ~/sanic-healthchecks
    steps:
      - checkout
      - run: pip install poetry==0.12.11
      - run: poetry install
      - run: poetry run python -m black --check .
      - run: poetry run python -m pylint examples sanic_healthchecks

  # deploy:
  #   docker:
  #     - image: python:3.7
  #   working_directory: ~/sanic-healthchecks
  #   steps:
  #     - checkout
  #     - run: pip install pipenv==2018.11.26
  #     - run: pipenv install --dev
  #     - run:
  #         name: Verify git tag vs. version
  #         command: |
  #           echo "CIRCLE_TAG=$(git tag -l --points-at HEAD)" > .env
  #           cat .env
  #           pipenv run python setup.py verify
  #     - run:
  #         name: Init .pypirc
  #         command: |
  #           echo -e "[pypi]" >> ~/.pypirc
  #           echo -e "username = abatilo" >> ~/.pypirc
  #           echo -e "password = $PYPI_PASSWORD" >> ~/.pypirc
  #     - run:
  #         name: Create packages
  #         command: |
  #           pipenv run python setup.py sdist
  #           pipenv run python setup.py bdist_wheel
  #     - run:
  #         name: Upload packages
  #         command: |
  #           pipenv run twine upload dist/*

workflows:
  version: 2
  build:
    jobs:
      - lint
      # - deploy:
      #     requires:
      #       - lint
      #     filters:
      #       branches:
      #         only: master
      #       tags:
      #         only: /[0-9]\.[0-9]\.[0-9]/
